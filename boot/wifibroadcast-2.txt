#!/bin/bash
#
# Общие настройки (необходимо синхронизировать как для воздушного блока, так и для наземной станции!)
# ============================================================
#
# Желаемая частота в МГц
# Диапазон частот 2,3 ГГц и 2,5–2,7 ГГц работает только со стиками на чипсете Atheros. Перед вклюнием на передачу ознакомьтесь с местными законами!
# Частоты выше 2512 МГц работают со стиками на чипсете Atheros, но с гораздо меньшей мощностью передачи и чувствительностью, 
# что значительно снижает диапазон. Используется только для ближнего радиуса действия!
FREQ=5280
#
# Поддерживаются следующие частоты:
# 2412, 2417, 2422, 2427, 2432, 2437, 2442, 2447, 2452, 2457, 2462, 2467, 2472, 2484 (Ralink and Atheros)
# 2312, 2317, 2322, 2327, 2332, 2337, 2342, 2347, 2352, 2357, 2362, 2367, 2372, 2377, 2382, 2387, 2392, 2397, 2402, 2407 (Atheros only)
# 2477, 2482, 2487, 2489, 2492, 2494, 2497, 2499, 2512, 2532, 2572, 2592, 2612, 2632, 2652, 2672, 2692, 2712 (Atheros only)
#
# 5180, 5200, 5220, 5240, 5260, 5280, 5300, 5320
# 5500, 5520, 5540, 5560, 5580, 5600, 5620, 5640, 5660, 5680, 5700
# 5745, 5765, 5785, 5805, 5825
#
# Установите значение «single» для одного передающего стика, для двух передающих стиков установите значение «dual» или «auto».
# MAC-адреса и частота для Воздушного блока и Наземной станции должны быть установлены ниже, если режим передачи включен как «двойной». (Стики на чипе AR9271 не поддерживают двойной режим передачи)
# Здесь необходимо установить только частоту передающих стиков если режим передачи включен как "auto". (в режиме "auto" должны использовать две одинаковые КАРТЫ)
TXMODE=single
#
FREQ_TX[0]=5805
#MAC_TX[0]=ec3dfd3090ce
#MAC_RX[0]=a854b22e6532
#MAC_RX[2]=24050f953378
#
FREQ_TX[1]=5220
#MAC_TX[1]=08107a4e1a4c
#MAC_RX[1]=a854b22e620d
#MAC_RX[3]=24050f953373
#
# Установите "Y" на на Наземной станции для автоматического сканирования. На Воздушном блоке все еще нужно установить частоту!
# Функция может быть глючной или вообще не работать!
FREQSCAN=N
#
# Мощность передачи воздушного блока/Наземной снанции - для всех типов стиков.
txpower=54
#
# Стики на чипсетах RTL8812au и RTL8814AU поддерживают STBC и LDPC, STBC_LDPC = Y,
# Стики на чипсетах RTL8811AU не поддерживает STBC, STBC_LDPC = N,
# Стики на чипсетах серий Ralink и Atheros не поддерживают STBC и LDPC, STBC_LDPC = N.
STBC_LDPC=Y
#
# Установите "svpcom", чтобы использовать метод передачи видео SVPCOM, или установите "rawsock", чтобы использовать метод RAWSOCK.
# svpcom более удобен для ip-камер и usb-камер, rawsock более удобен для камер интерфейса CSI
# rawsock более удобен для мониторов с HDMI входом, svpcom больше подходит для телефонов/планшетов android/ios или наземных станций на базе ПК
STREAM=svpcom
#
# Настройки FEC
# Максимальная длина блока для стиков на чипсетах Ralink = 2278, для стиков на чипсетах Atheros = 1550
# минимально разумная длина блока ~ 700
VIDEO_BLOCKS=6
VIDEO_FECS=2
VIDEO_BLOCKLENGTH=1536
#
# Метод передачи телеметрии:
# wbc = использует wifibroadcast в качестве восходящей / нисходящей канала телеметрии
# external = использовать внешние средства в качестве восходящего / нисходящего канала телеметрии (LRS или 3DR)
# если значение параметра установлено как external, требуется установить последовательный порт, к которому подключен LRS или 3DR как на Наземной станции, 
# так и на Воздушном блоке
TELEMETRY_TRANSMISSION=wbc
#
# Установка протокола OSD:
# mavlink -> Протокол Mavlink (APM / Pixhawk)
# ltm -> Облегченная телеметрия (iNav / Cleanflight / Betaflight)
# frsky -> Старый протокол Frsky (приемники Frsky серии D)
# smartport -> Новый протокол Frsky (приемники Frsky серии X)
# vot -> Eagletree Vector Open Telemetry
TELEMETRY_OSD=mavlink
#
# Установите "disabled" или "mavlink" для Mavlink (приложение Tower, Missionplanner и т. Д.)
TELEMETRY_UPLINK=mavlink
#
# Установите ID RC и восходящего канала, числовой диапазон (0-99). Только Наземные станции с таким же ID,
# как у Воздушного блока, могут передовать данные и RC вверх.
LINK_RC_KEY=3
#
# Установите для этого параметра значение «mavlink», чтобы включить RC по wifibroadcast с использованием протокола mavlink или «msp» для протокола MSP
# Установите "sumd" для Graupner SUMD, "ibus" для Flysky IBUS, "srxl" для мультиплексного режима SRXL/XBUS B. Установите "disabled", чтобы отключить
# Другие настройки см. В файле joyconfig.txt, настройки по умолчанию работают для Taranis в режиме USB-джойстика.
# Установите RC = disabled при использовании стиков на чипсете серии Ralink и чипсете RTL8814AU (которая не поддерживает RTS фрейм).
# Для  R/C необходима поддержка RTS фреймов (поддерживают только ar7010/ar9271/rtl8812au/rtl8811au).
RC=disabled
#
# >>>>>>>>>>[DEDICATED WIFI-CARD UPLINK/RC MAC ADDR.]-- 
#RC_NIC=112233445566
#
#
# Настройки Воздушного блока
# ============================================================
#
# Скорость передачи данных. Меньшие значение дают большую дальность связи и наоборот.
# 1 = 5,5 Мбит, 2 = 11 Мбит, 3 = 12 Мбит, 4 = 18 Мбит, 5 = 24 Мбит, 6 = 36 Мбит
DATARATE=3
#
# Установите значение параметра "auto" для автоматического расчета битрейта видео и умножения его на VIDEO_BLOCKS/(VIDEO_FECS+VIDEO_BLOCKS).
# Установите фиксированное значение параметра Менее 100 для автоматического расчета битрейта видео и умножения его на VIDEO_BITRATE. (Например： VIDEO_BITRATE=70)
# Установите фиксированное значение больше 100, чтобы отключить автоматический расчет. (Например, ： VIDEO_BITRATE = 4096)
VIDEO_BITRATE=auto
#
# Настройки изображения камеры
# V1 cam: 1296x730: 25fps, 30fps, 48fps. 1920x1080: 25fps, 30fps
# V2 cam: 1280x720: 25fps, 30fps, 59fps, 90fps. 1640x922: 25fps, 30fps, 40fps. 1920x1080: 25fps, 30fps
WIDTH=1920
HEIGHT=1080
FPS=30
#
# Меньшие значения параметра означают более быстрое восстановление после сбоев, но также более низкое качество картинки.
# При fps = 48 и keyframerate = 5 глюки в худшем случае будут оставаться видимыми около 100 мс.
# Вы можете установить это значение выше или ниже в соответствии с вашими потребностями. Минимальное значение - 2.
KEYFRAMERATE=8
#
# Задайте здесь дополнительные параметры raspivid
# Общие настройки интерфейса CSI:
# Параметр "-cs 1" необходимо добавить при использовании разъемов CAM1 вычислительного модуля (CM / CM3)
#EXTRAPARAMS="-cd H264 -n -fl -ih -pf high -if both -cs 1"
EXTRAPARAMS="-cd H264 -n -fl -ih -pf high -if both" 
# 
# Настройки эффектов камеры Raspberry (V1 / V2 / HQ cam):
#EFFECT="-ex auto -mm matrix -awb horizon -drc high -vs -sa 20 -sh 25 -co 10 -vf -hf"
EFFECT="-ex auto -mm spot -awb auto"
#
# Последовательный порт и скорость передачи (минимум 19200) для использования R/C-соединения между Воздушным блоком  и полетным контроллером
# Установите значение "FC_RC_SERIALPORT=/dev/serial0" для встроенного последовательного порта Pi или "FC_RC_SERIALPORT=/dev/ttyUSB0" для адаптера USB-to-serial.
FC_RC_SERIALPORT=/dev/serial0
FC_RC_BAUDRATE=57600
#
# Последовательный порт и скорость использования для телеметрического соединения между Воздушным блоком  и полетным контроллером
# Установите значение "FC_TELEMETRY_SERIALPORT=/dev/serial0" для встроенного последовательного порта Pi или "FC_TELEMETRY_SERIALPORT=/dev/ttyUSB0" для адаптера USB-to-serial.
FC_TELEMETRY_SERIALPORT=/dev/serial0
FC_TELEMETRY_BAUDRATE=57600
#
# Пока не поддерживается, не меняйте
FC_MSP_SERIALPORT=/dev/ttyUSB0
FC_MSP_BAUDRATE=115200
#
# Задайте здесь дополнительные параметры USB-камеры: (значение по умолчанию для RUNCAM USBcamera)
USBCAM="v4l2src device=/dev/video0 ! video/x-h264,width=1280,height=720,framerate=30/1,stream-format=\"byte-stream\""
# Задайте здесь дополнительные параметры IP-камеры: (значение по умолчанию для xm530ai/xm535ai Chip IPC)
IPCAM="rtspsrc location=\"rtsp://192.168.1.10:554/user=admin&password=&channel=1&stream=0.sdp\" latency=0"
#
#
# Настройки Наземной станции
# ============================================================
#
# Установите "Y", чтобы сканировать сети Wi-Fi с помощью airodump-ng перед запуском Наземной станции
AIRODUMP=N
#
# Количество секунд отображения Wi-Fi сканера. Минимальное рекомендуемое время сканирования - 25 секунд.
AIRODUMP_SECONDS=25
#
# Установите значение "Y", чтобы включить точку доступа Wi-Fi. SSID по умолчанию - «EZ-Wifibroadcast», без пароля.
# См. Apconfig.txt для конфигурации. При этом полученные потоки видео и телеметрии будут перенаправлены на
# смартфон / планшет или компьютер, подключенный к RX Pi через Wi-Fi.
# При использовании PI со встроенным Wi-Fi(PI Zero W \3B\3A \3B ...) или использовании Wi-Fi карт серии rtl88xxau/ralink на воздушном блоке, 
# то wifihotspot наземного блока включен, автоматическая синхронизация конфигурационного файла будет осуществляться в фоновом режиме.  
# Чтобы использовать конфигурационный файл автоматической синхронизации, наземный блок должен быть сначала полностью запущен, а затем включен воздушный блок.
WIFI_HOTSPOT=Y
#
# Установите значение "internal", чтобы использовать внутренний Wi-Fi Pi или MAC-адрес USB-стика, который вы хотите использовать
WIFI_HOTSPOT_NIC=internal
#
# установите значение "Y", чтобы включить точку Ethernet.Это позволит пересылать полученные видео и 
# телеметрические потоки на другой компьютер или другое устройство, подключенное к малины через Ethernet
ETHERNET_HOTSPOT=N
#
# Установите "Y", чтобы разрешить периодические снимки экрана каждые 10 секунд.
# Периодические снимки экрана отключены, когда Pi zero/W, A+, B+ использовались в качестве Наземной станции, этот элемент недействителен.
ENABLE_SCREENSHOTS=N
#
# Установите значение "memory", чтобы использовать RAMdisk для временного хранения видео/снимков экрана/телеметрии. Это ограничивает время записи
# до ~ 12-14 минут, но это безопасный способ. Если вам нужно более длительное время записи, используйте значение "SDCard", чтобы использовать SD-карту
# в качестве временного хранилища видео. Однако имейте в виду, что это может вызвать заикание видео и/или битые блоки.
# Используйте быструю SD-карту и ВНИМАТЕЛЬНО ПРОВЕРЬТЕ ЕЁ ПЕРЕД ИСПОЛЬЗОВАНИЕМ!
# Сохранение видео отключено, когда Pi zero/W, A+, B+ использовались в качестве Наземной станции, этот элемент недействителен.
VIDEO_TMP=disabled
#
# Установите значение "Y", чтобы включить режим ретрансляции. При этом полученные видеопотоки и потоки телеметрии будут перенаправлены
# на другой приемник wifibroadcast. Примечание! В настоящее время значение RSSI, которое вы видите на приемнике за ретранслятором, не является RSSI
# между самолетом и землей, отображаемое значение является уровнем сигнала между ретранслятором и приемником на земле!
RELAY=N
RELAY_NIC=a854b22e6532
RELAY_FREQ=2382
#
# Установите значение "Y",для отображения OSD и текстовых сообщений
# USB-накопитель можно подключить в Наземную станцию для анализа телеметрических данных после завершения полета.
# Установите значение «N» для отключения функции OSD, текстовых сообщений, периодических снимков экрана и хранения видео одновременно.
# Если в качестве наземного устройства использовалось Pi ноль / W, A +, B +, экранное меню не отображается, этот элемент недействителен.
OSD=Y
#
# Настройки последовательного порта при использовании TELEMETRY_TRANSMISSION=external
# Установите значение "/dev/serial0" для встроенного последовательного порта Pi или "/dev/ttyUSB0" для адаптера USB-to-serial.
# скорость передачи данных последовательного порта, используемые Наземной станцией для внешней телеметрии.
EXTERNAL_TELEMETRY_SERIALPORT_GROUND=/dev/serial0
EXTERNAL_TELEMETRY_SERIALPORT_GROUND_BAUDRATE=57600
#
# Установите значенеи "Y", для вывода телеметрии на последовательный порт Наземной станции (для антенного трекера и т.д.)
ENABLE_SERIAL_TELEMETRY_OUTPUT=N
#
# Установите значение "/dev/serial0" для использования встроенного последовательного порта Наземной станции или "/dev/ttyUSB0" для адаптера USB-to-serial.
# последовательный порт Наземной станции, используемый для вывода телеметрии.
TELEMETRY_OUTPUT_SERIALPORT_GROUND=/dev/serial0
#
# Установите значение "raw", чтобы пересылать необработанный поток h264 на 2-е устройства отображения (для приложения FPV_VR),
# Установите значение "rtp" для пересылки потока H264 RTP (для приложений QGC / Tower, gstreamer и т. Д.).
FORWARD_STREAM=raw
#
# Двойная камера (USBCAM/IPCAM + CSI-камера)с использованием метода RAWSOCK и SVPCOM одновременно передает два видео-потока h264.
# использовать GPIO18 (кнопка 12) для переключения двух камер (usbcam / IPCAM + CSI интерфейс веб - камеры)
# Порт UDP для отправки видеопотока в приложение Android или программу ПК, VIDEO_UDP_PORT для основного CAM1, VIDEO_UDP_PORT2 для второго CAM2
VIDEO_UDP_PORT1=5600
VIDEO_UDP_PORT2=5601
#
# Используемый метод перенаправления Mavlink. Выберите "mavlink-routerd" или "cmavnode"
MAVLINK_FORWARDER=mavlink-routerd
#
# Установите значение "Y", для включения сбора дополнительных даннх для журналов отладки. Если у вас возникнут какие-либо проблемы,
# пожалуйста, повторите все с отладкой, установленной значение параметра «Y», а затем подключите карту памяти USB, вы
# найдете журналы отладки на карте памяти.
DEBUG=N
#
#
# VEYE IMX290/IMX327 camera settings
# ============================================================
# IMX327_videoformat value:PAL PAL(50Hz 25FPS),NTSC NTSC(60Hz 30FPS).
IMX327_videoformat=NTSC
#
# IMX327_mirrormode value:0x00 Normal,0x01 Mirror,0x02 V-Flip,0x03 Mirror And V-Flip(180 Degree Rotate) 
IMX327_mirrormode=0x00
#
# IMX327_denoise value:
# 0x00 2D=OFF;3D=OFF,0x01 2D=OFF;3D=LOW,0x02 2D=OFF;3D=MIDDLE,0x03 2D=OFF;3D=HIGH
# 0x04 2D=LOW;3D=OFF,0x05 2D=LOW;3D=LOW,0x06 2D=LOW;3D=MIDDLE,0x07 2D=LOW;3D=HIGH
# 0x08 2D=MIDDLE;3D=OFF,0x09 2D=MIDDLE;3D=LOW,0x0A 2D=MIDDLE;3D=MIDDLE,0x0B 2D=MIDDLE;3D=HIGH
# 0x0C 2D=HIGH;3D=OFF,0x0D 2D=HIGH;3D=LOW,0x0E 2D=HIGH;3D=MIDDLE,0x0F 2D=HIGH;3D=HIGH 
IMX327_denoise=0x00
#
# IMX327_daynightmode value:0xFF Color Mode,0xFE Black&White Mode,0xFC Trigger Mode 
IMX327_daynightmode=0xFC
#
# IMX327_agc value range:[0x00~0x0F] AGC intensity,agc indicated max gain of AE mode.
IMX327_agc=0x00
#
# IMX327_aespeed1 and IMX327_aespeed2 value range:[0x00-0x64],AE adjust speed,IMX327_aespeed1 is agc speed, IMX327_aespeed2 is shutter speed,Slow to Fast.
IMX327_aespeed1=0x32
IMX327_aespeed2=0x32
#
# IMX327_contrast value range:[0x00-0xFF],contrast.
IMX327_contrast=0x80
#
# IMX327_saturation value range:[0x00-0x64],saturation.
IMX327_saturation=0x32
#
# IMX327_brightness value range:[0x00-0x64],brightness.
IMX327_brightness=0x32
#
# IMX327_sharppen1 value:0x0 sharppen disable,0x1 sharppen enable.IMX327_sharppen2 value:[0x0-0xA],sharppen strength.
IMX327_sharppen1=0x1
IMX327_sharppen2=0xA
#
# IMX327_wdrmode value:0x00 Back Light Mode OFF,0x01 Back Light Mode ON, LOW,0x02 Back Light Mode ON, HIGH 0x03 DOL WDR Enable.
IMX327_wdrmode=0x03
#
# IMX327_wdrtargetbr value range:[0x00-0xFF],The overall AE target value in WDR mode.Takes effect in WDR mode.
IMX327_wdrtargetbr=0x80
#
# IMX327_wdrbtargetbr value range:[0x00-0xFF],The AE target value of the bright area in WDR mode.Takes effect in WDR mode.
IMX327_wdrbtargetbr=0x30

# VEYE IMX307/SC132 camera settings
# ============================================================
# IMX307_videoformat value:50 PAL(50Hz 25FPS、50FPS、100FPS),60 NTSC(60Hz 30FPS、60FPS、120FPS).
IMX307_videoformat=60
#
# IMX307_mirrormode value:0 Normal,1 Flip,2 Mirror,3 Mirror And Flip(180 Degree Rotate)
IMX307_mirrormode=0
#
# IMX307_daynightmode value:0x1 Color Mode,0x2 Black&White Mode,0x0 Trigger Mode,0x3 IR-CUT day, Image Black&White mode,0x4 IR-CUT night, Image Color mode
IMX307_daynightmode=0x1
#
# IMX307_contrast value range:[0,100],contrast.
IMX307_contrast=50
#
# IMX307_saturation value range:[0,100],saturation.
IMX307_saturation=50
#
# IMX307_hue value range:[0,100],hue.
IMX307_hue=50
#
# IMX307_aetarget value range:[0,255],The target brightnes.
IMX307_aetarget=127